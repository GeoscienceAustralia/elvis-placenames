"use strict";function ContributorsService(e){var t={show:!1,ingroup:!1,stick:!1};return e.get("placenames/resources/config/contributors.json").then(function(e){t.orgs=e.data}),{getState:function(){return t}}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function HelpCtrl(e,t){var n=this;e.info("HelpCtrl"),t.getFaqs().then(function(e){n.faqs=e})}function HelpService(e){var t="placenames/resources/config/faqs.json";return{getFaqs:function(){return e.get(t,{cache:!0}).then(function(e){return e.data})}}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function ResultsService(e,t,n,r,a,i,o){var s=13,c=void 0,l={showPan:function(e){return this.show(e).then(function(e){var t=e.map;return t.setView(e.location,s,{animate:!0}),e})},clear:function(e){e.searched=null,r(function(){n.$broadcast("clear.button.fired")},10)},show:function(e){return this.hide().then(function(t){var n=e.location.split(" ").reverse().map(function(e){return+e});return c=L.popup().setLatLng(n).setContent(e.name+"<br/>Lat/Lng: "+n[0]+"&deg;"+n[1]+"&deg;").openOn(t),{location:n,map:t,marker:c}})},download:function(t){this.config.then(function(n){e.get(n.esriTemplate.replace("${id}",t.join(","))).then(function(e){var t=new Blob([JSON.stringify(e,null,3)],{type:"application/json;charset=utf-8"});saveAs(t,"gazetteer-esri-features-"+Date.now()+".json")})})},hide:function(e){return i.getMap().then(function(e){return c&&e.removeLayer(c),e})},get config(){return a.getConfig().then(function(e){return e.results})},moreDocs:function(e){if(e){var t=e.data.response,n=t.docs.length;if(!(n>=t.numFound)){var r=e.params;r.start=n,o.request(r).then(function(e){var n;(n=t.docs).push.apply(n,_toConsumableArray(e.response.docs))})}}}};return l}function AboutService(e){var t={show:!1,ingroup:!1,stick:!1};return e.getConfig("about").then(function(e){t.items=e}),{getState:function(){return t}}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function SearchService(e,t,n,r,a,i){function o(e){return d().then(function(n){return n.q="recordId:"+e,y(n).then(function(e){return A.persist(n,e).then(function(){return c(e.facet_counts.facet_fields),t.$broadcast("pn.search.complete",e),e})})})}function s(){return d().then(function(e){return y(e).then(function(n){return A.persist(e,n).then(function(){return c(n.facet_counts.facet_fields),t.$broadcast("pn.search.complete",n),n})})})}function c(e){a.getAll().then(function(t){E.counts=u(e),t.authorities.forEach(function(e){e.count=E.counts.authorities[e.code],e.count=e.count?e.count:0}),["groups","features","categories"].forEach(function(e){t[e].forEach(function(t){t.count=E.counts[e][t.name],t.count=t.count?t.count:0})})})}function l(e){var t=void 0,n={};return e.forEach(function(e,r){r%2?n[t]=e:t=e}),n}function u(e){var t=void 0,n={};return Object.values(_).forEach(function(e){n[e]={}}),Object.keys(e).forEach(function(r){e[r].forEach(function(e,a){a%2?n[_[r]][t]=e:t=e})}),n}function p(){return i.getMap().then(function(e){return a.getAll().then(function(t){var n="object"===_typeof(M.filter),r=A.summary;return r.filter=n?M.filter.name:M.filter,r.bounds=e.getBounds(),r.authorities=t.authorities.filter(function(e){return e.selected}),r.current=[],t.groups.forEach(function(e){return r.current=r.current.concat(e.selections())}),r})})}function d(){return p().then(function(e){var t=x(),n=e.bounds;t.fq=getBounds(n),t["facet.heatmap.geom"]=S(n),t.sort=w(n),t.q=f(e);var r=v(),a=g();return a.length&&(t.q+=" AND ("+a.join(" ")+")"),r.length&&(t.q+=" AND ("+r.join(" ")+")"),t})}function f(e){var t=e.filter;return t?'"'+t.toLowerCase()+'"':"*:*"}function h(e){return a.getAuthorities().then(function(t){if(E.authorities&&E.authorities.length){var n=k(),r=v();return r.length&&(n.q+=" AND ("+r.join(" ")+")"),n.q=f(E),n.fq=e.fq,b(n).then(function(e){var n=l(e.facet_counts.facet_fields.authority);return t.forEach(function(e){e.allCount=n[e.code]}),e.facetCounts={},console.log("auth counts",e,E),e})}return t.forEach(function(e){e.allCount=E.counts.authorities[e.code]}),null})}function m(e){return a.getGroups().then(function(t){var n=C(["group","category","feature"]);n.q=f(E);var r=g();return r.length&&(n.q+=" AND ("+r.join(" ")+")"),n.fq=e.fq,b(n).then(function(e){var n=l(e.facet_counts.facet_fields.group),r=l(e.facet_counts.facet_fields.category),a=l(e.facet_counts.facet_fields.feature);return t.forEach(function(e){e.allCount=n[e.name],e.categories.forEach(function(e){e.allCount=r[e.name],e.features.forEach(function(e){e.allCount=a[e.name]})})}),e.facetCounts={},e})})}function g(){return E.authorities.map(function(e){return"authority:"+e.code})}function v(){return E.current.map(function(e){return e.label+':"'+e.name+'"'})}function y(e){return b(e).then(function(e){return e.facetCounts={},t.$broadcast("pn.facets.changed",e.facet_counts.facet_fields),e})}function b(t){return e({url:"/select?",method:"GET",params:t,cache:!0}).then(function(e){return e.data})}function w(e){var t=(e.getEast()-e.getWest())/2,n=(e.getNorth()-e.getSouth())/2;return"geodist(ll,"+(e.getSouth()+n)+","+(e.getWest()+t)+") asc"}function S(e){return"["+Math.max(e.getSouth(),-90)+","+Math.max(e.getWest(),-180)+" TO "+Math.min(e.getNorth(),90)+","+Math.min(e.getEast(),180)+"]"}function k(){return{facet:!0,"facet.field":["authority"],rows:0,wt:"json"}}function C(e){var t={"facet.limit":-1,facet:!0,rows:0,wt:"json"};return e&&(t["facet.field"]=e),t}function x(){return{"facet.heatmap.format":"ints2D","facet.heatmap":"location","facet.limit":-1,facet:!0,"facet.field":["feature","category","authority","group"],rows:50,wt:"json"}}var M={searched:null},_={group:"groups",authority:"authorities",feature:"features",category:"categories"},E={},$=[],F=void 0,A={onMapUpdate:function(e){$.push(e)},offMapUpdate:function(e){delete $[e]},get data(){return M},get summary(){return E},filtered:function(){return s().then(function(e){M.filtered=e;var t=e.responseHeader.params;return h(t),m(t),e})},request:function(e){return b(e)},search:function(e){var t=this;e?o(e.recordId).then(function(){return t.searched()}):this.searched()},persist:function(e,t){return M.persist={params:e,data:t},i.getMap().then(function(e){return M.persist.bounds=e.getBounds()})},searched:function(){M.searched=M.persist,M.searched.data.restrict=map.getBounds(),this.hide()},show:function(e){this.hide().then(function(t){var n=e.location.split(" ").reverse().map(function(e){return+e});F=L.popup().setLatLng(n).setContent(e.name+"<br/>Lat/Lng: "+n[0]+"&deg;"+n[1]+"&deg;").openOn(t)})},hide:function(e){return i.getMap().then(function(e){return F&&e.removeLayer(F),e})}};return i.getMap().then(function(e){function r(){t.$broadcast("pn.search.start"),n.cancel(a),M.searched?t.$broadcast("pn.search.complete",M.searched.data):(a=n(function(){A.filtered()},20),$.forEach(function(e){e()}))}var a=void 0;e.on("resize moveend viewreset",r)}),A}function getBounds(e,t){var n=void 0;if(t){var r=Math.max(e.getWest(),-180,t.getWest()),a=Math.min(e.getEast(),180,t.getEast()),i=Math.min(e.getNorth(),90,t.getNorth()),o=Math.max(e.getSouth(),-90,t.getSouth());n="location:["+(o>i?i:o)+","+(r>a?a:r)+" TO "+i+","+a+"]"}else n="location:["+Math.max(e.getSouth(),-90)+","+Math.max(e.getWest(),-180)+" TO "+Math.min(e.getNorth(),90)+","+Math.min(e.getEast(),180)+"]";return n}angular.module("placenames.autoscroll",[]).directive("autoScroll",["$timeout","$rootScope",function(e,t){return{scope:{trigger:"@",y:"@",height:"@"},link:function(n,r,a){var i=void 0,o=void 0,s=void 0;s=n.height?+n.height:100,o=s,r.on("scroll",function(c){var l=r.scrollTop(),u=r.find(a.autoScroll),p=u.height(),d=r.height(),f=void 0,h=void 0;d>=p||(f=p-l-d,h=o<f,o=f,f<s&&!h&&(i&&e.cancel(i),i=e(function(){t.$broadcast(n.trigger)},30)))})}}}]),angular.module("placenames.authorities",[]).directive("placenamesAuthorities",["groupsService","searchService",function(e,t){return{restrict:"EA",templateUrl:"authorities/authorities.html",link:function(n){e.getAuthorities().then(function(e){return n.authorities=e}),n.change=function(e){t.filtered()}}}}]),angular.module("placenames.categories",[]).directive("placenamesCategories",["groupsService","searchService",function(e,t){return{templateUrl:"categories/categories.html",link:function(n){e.getCategories().then(function(e){return n.categories=e}),n.change=function(){t.filtered()}}}}]).directive("placenamesCategoryChildren",[function(){return{templateUrl:"categories/features.html",scope:{features:"="}}}]);var declusteredIcon=L.icon({iconUrl:"https://unpkg.com/leaflet@1.2.0/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.2.0/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.2.0/dist/images/marker-shadow.png",iconSize:[16,25],iconAnchor:[7,26],popupAnchor:[1,-22],tooltipAnchor:[10,-18],shadowSize:[25,25]});angular.module("placenames.contributors",[]).directive("placenamesContributors",["$interval","contributorsService",function(e,t){return{templateUrl:"contributors/contributors.html",scope:{},link:function(n,r){var a=void 0;n.contributors=t.getState(),n.over=function(){e.cancel(a),n.contributors.ingroup=!0},n.out=function(){a=e(function(){n.contributors.ingroup=!1},1e3)},n.unstick=function(){n.contributors.ingroup=n.contributors.show=n.contributors.stick=!1,r.find("a").blur()}}}}]).directive("placenamesContributorsLink",["$interval","contributorsService",function(e,t){return{restrict:"AE",templateUrl:"contributors/show.html",scope:{},link:function(n){var r=void 0;n.contributors=t.getState(),n.over=function(){e.cancel(r),n.contributors.show=!0},n.toggleStick=function(){n.contributors.stick=!n.contributors.stick,n.contributors.stick||(n.contributors.show=n.contributors.ingroup=!1)},n.out=function(){r=e(function(){n.contributors.show=!1},700)}}}}]).factory("contributorsService",ContributorsService).filter("activeContributors",function(){return function(e){return e?e.filter(function(e){return e.enabled}):[]}}),ContributorsService.$inject=["$http"],angular.module("placenames.feature",[]).directive("placenamesFeatures",["groupsService","searchService",function(e,t){return{templateUrl:"features/features.html",link:function(n){e.getFeatures().then(function(e){return n.features=e}),n.change=function(){t.filtered()}}}}]),angular.module("placenames.download",["placenames.zone"]).directive("placenamesDownload",["flashService","messageService","placenamesDownloadService","zoneService",function(e,t,n,r){return{templateUrl:"download/download.html",scope:{data:"="},link:function(a){function i(e){a.processing.filename&&a.processing.filename.length>16&&(a.processing.filename=a.processing.filename.substr(0,16)),a.processing.validFilename=!a.processing.filename||a.processing.filename.match(/^[a-zA-Z0-9\_\-]+$/)}a.processing=n.data,r.counts(a.data).then(function(e){a.outCoordSys=e}),a.$watch("processing.filename",i),a.submit=function(){var r=e.add("Submitting your job for processing",null,!0);a.processing.outFormat.restrictCoordSys&&(a.processing.outCoordSys=a.processing.config.outCoordSys.find(function(e){return e.code===a.processing.outFormat.restrictCoordSys}),t.warn(a.processing.outFormat.restrictMessage)),n.submit(a.data.params).then(function(e){var n=e.data;r.remove(),"success"===n.serviceResponse.statusInfo.status?t.success("Your job has successfuly been queued for processing."):t.warn("The request has failed. Please try again later and if problems persist please contact us")})["catch"](function(){r.remove(),t.warn("The request has failed. Please try again later and if problems persist please contact us")})},i()}}}]).factory("placenamesDownloadService",["$http","configService","storageService",function(e,t,n){var r="download_email",a={data:{show:!1,email:null,validFilename:!1,dataFields:"common",get valid(){return 100===this.percentComplete},get validEmail(){return this.email},get validProjection(){return this.outCoordSys},get validFormat(){return this.outFormat},get percentComplete(){return(this.validEmail?25:0)+(this.validFilename?25:0)+(this.validProjection?25:0)+(this.validFormat?25:0)}},submit:function(t){var n=t.fq,r=t.q,a={file_name:this.data.filename?this.data.filename:"output_filename",file_format_vector:this.data.outFormat.code,coord_sys:this.data.outCoordSys.code,data_fields:this.data.dataFields,email_address:this.data.email,params:{q:r,fq:n}};return this.setEmail(this.data.email),this.data.fileName&&(a.file_name=this.data.fileName),e({url:this.data.config.serviceUrl,method:"POST",headers:{"Content-Type":"application/json"},data:a})},setEmail:function(e){n.setItem(r,e)},getEmail:function(){return n.getItem(r).then(function(e){return a.data.email=e,e})}};return t.getConfig("download").then(function(e){return a.data.config=e}),a.getEmail().then(function(e){return a.data.email=e}),a}]).filter("productIntersect",function(){return function(e,t){return t&&e?e.filter(function(e){if(!e.extent)return!0;var n=e.extent,r=n.xMax,a=n.xMin,i=n.yMax,o=n.yMin,s=void 0;try{s=t.intersects([[o,a],[i,r]])}catch(c){return console.error("Couldn't test for intersects",c),!1}return s}):e}}),angular.module("placenames.tree",[]).directive("placenamesTree",["groupsService","searchService",function(e,t){return{templateUrl:"filters/tree.html",restrict:"AE",link:function(n){e.getGroups().then(function(e){return n.groups=e}),n.change=function(e){t.filtered(),e.selected&&(e.expanded=!0)}}}}]).filter("withTotals",function(){return function(e){if(e)return e.filter(function(e){return e.total})}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Group=function(){function e(){_classCallCheck(this,e),this.label="group",this.color="#4286f4",this._selected=!1}return _createClass(e,[{key:"selections",value:function(){var e=[];return this.selected&&(this.categories.forEach(function(t){e.push.apply(e,_toConsumableArray(t.selections()))}),!e.length)?[this]:e}},{key:"selected",get:function(){return this._selected},set:function(e){this._selected=e,!e&&this.categories&&this.categories.forEach(function(e){return e.selected=!1})}},{key:"selectExpand",get:function(){return this.selected},set:function(e){this.selected=e,e&&(this.expanded=e)}}]),e}(),Category=function(){function e(){_classCallCheck(this,e),this.label="category",this.color="#21a470",this._selected=!1}return _createClass(e,[{key:"selections",value:function(){var e=[];return this.selected&&(e=this.features.filter(function(e){return e._selected}),!e.length)?[this]:e}},{key:"selected",get:function(){return this._selected},set:function(e){this._selected=e,e?this.parent.selected=!0:this.features&&this.features.forEach(function(e){return e.selected=!1})}},{key:"selectExpand",get:function(){return this.selected},set:function(e){this.selected=e,e&&(this.expanded=e)}}]),e}(),Feature=function(){function e(){_classCallCheck(this,e),this.label="feature",this.color="#d68a39",this._selected=!1}return _createClass(e,[{key:"selections",value:function(){return this.selected?[this]:[]}},{key:"selected",get:function(){return this._selected},set:function(e){this._selected=e,e&&(this.parent.selected=!0)}}]),e}(),createCategories=function(e){e.categories=Object.keys(e.groups)};angular.module("placenames.groups",["placenames.feature","placenames.categories"]).directive("placenamesGroups",["groupsService","searchService",function(e,t){return{templateUrl:"groups/groups.html",link:function(n){e._loadGroups().then(function(e){n.data=e}),n.change=function(){console.log("Update groups"),t.filtered()}}}}]).directive("placenamesGroupChildren",["groupsService",function(e){return{templateUrl:"groups/category.html",scope:{category:"="}}}]).factory("groupsService",["$http","$q","$rootScope","configService","mapService",function(e,t,n,r,a){var i={};return i._loadGroups=function(){return i.config?(i.promise=null,t.when(i.config)):i.promise?i.promise:(i.promise=i.getCounts().then(function(t){return r.getConfig().then(function(n){var r=n.groups;return i.config=r,e.get(r.referenceDataLocation).then(function(e){var a=e.data;return r.data=a,r.categories=[],r.features=[],r.authorities=n.authorities,r.authorities.forEach(function(e){var n=t.authority[e.code];e.total=n?n:0}),r.groups=Object.keys(a).filter(function(e){return!("name"===e||"definition"===e)}).map(function(e){var n,i=new Group;return Object.assign(i,{name:e,total:t.group[e]?t.group[e]:0,definition:a[e].definition,categories:Object.keys(a[e]).filter(function(e){return!("name"===e||"definition"===e)}).map(function(n){var r=new Category;return Object.assign(r,{name:n,total:t.category[n]?t.category[n]:0,definition:a[e][n].definition,parent:i,features:a[e][n].features.map(function(e){var n=new Feature;return Object.assign(n,e,{parent:r,total:t.feature[e.name]?t.feature[e.name]:0}),n})}),r})}),(n=r.categories).push.apply(n,_toConsumableArray(i.categories)),i.categories.forEach(function(e){var t;(t=r.features).push.apply(t,_toConsumableArray(e.features))}),i}),r.authorities=r.authorities.filter(function(e){return e.total}),r.groups=r.groups.filter(function(e){return e.total}),r.categories=r.categories.filter(function(e){return e.total}),r.features=r.features.filter(function(e){return e.total}),window.larry=r.groups,r})})}),i.promise)},i.getCategories=function(){return i._loadGroups().then(function(){return i.config.categories})},i.getAll=function(){return i._loadGroups().then(function(){return i.config})},i.getAuthorities=function(){return i._loadGroups().then(function(){return i.config.authorities})},i.getGroups=function(){return i._loadGroups().then(function(){return i.config.groups})},i.getFeatures=function(){return i._loadGroups().then(function(){return i.config.features})},i.getCounts=function(){return r.getConfig("groups").then(function(t){var n=t.referenceDataCountsUrl;return e.get(n).then(function(e){var t=e.data,n=t.facet_counts.facet_fields,r={feature:{},category:{},group:{},authority:{}},a=void 0;return["feature","category","group","authority"].forEach(function(e){n[e].forEach(function(t,n){n%2?r[e][a]=t:a=t})}),r})})},i}]),angular.module("placenames.header",[]).controller("headerController",["$scope","$q","$timeout",function(e,t,n){var r=function(e){return e};e.$on("headerUpdated",function(t,n){e.headerConfig=r(n)})}]).directive("placenamesHeader",[function(){var e={current:"none",heading:"ICSM",subheading:"ICSM",headingtitle:"ICSM",helpurl:"help.html",helptitle:"Get help about ICSM",helpalttext:"Get help about ICSM",skiptocontenttitle:"Skip to content",skiptocontent:"Skip to content",quicklinksurl:"/search/api/quickLinks/json?lang=en-US"};return{transclude:!0,restrict:"EA",templateUrl:"header/header.html",scope:{current:"=",breadcrumbs:"=",heading:"=",subheading:"=",headingtitle:"=",helpurl:"=",helptitle:"=",helpalttext:"=",skiptocontenttitle:"=",skiptocontent:"=",quicklinksurl:"="},link:function(t,n,r){angular.copy(e);angular.forEach(e,function(e,n){n in t||(t[n]=e)})}}}]),angular.module("placenames.lock",[]).directive("placenamesLock",[function(){return{scope:{hover:"="},template:'<i class="fa fa-lock" aria-hidden="true" title="The features shown on the map are locked to the current search results. Clear your search results to show more features"></i>'}}]),angular.module("placenames.help",[]).directive("placenamesHelp",[function(){return{templateUrl:"help/help.html"}}]).directive("placenamesFaqs",[function(){return{restrict:"AE",templateUrl:"help/faqs.html",scope:{faqs:"="},link:function(e){e.focus=function(e){$("#faqs_"+e).focus()}}}}]).controller("HelpCtrl",HelpCtrl).factory("helpService",HelpService),HelpCtrl.$inject=["$log","helpService"],HelpService.$inject=["$http"],angular.module("placenames.pill",[]).directive("placenamesPill",["searchService",function(e){return{restrict:"EA",templateUrl:"pill/pill.html",scope:{item:"=",update:"&",name:"@?"},link:function(t){t.item.label&&(t.label=t.item.label.charAt(0).toUpperCase()+t.item.label.slice(1)+": "),t.name||(t.name="name"),t.deselect=function(){t.item.selected=!1,e.filtered()}}}}]),angular.module("placenames.altthemes",["placenames.storage"]).directive("altThemes",["altthemesService",function(e){return{restrict:"AE",templateUrl:"navigation/altthemes.html",scope:{current:"="},link:function(t){e.getThemes().then(function(e){t.themes=e}),e.getCurrentTheme().then(function(e){t.theme=e}),t.changeTheme=function(n){t.theme=n,e.setTheme(n.key)}}}}]).controller("altthemesCtrl",["altthemesService",function(e){this.service=e}]).filter("altthemesFilter",function(){return function(e,t){var n=[];return t?(e&&e.forEach(function(e){e.themes&&e.themes.some(function(e){return e===t.key})&&n.push(e)}),n):e}}).factory("altthemesService",["$q","$http","storageService",function(e,t,n){var r="placenames.current.theme",a="placenames/resources/config/themes.json",i="All",o=[],s=this;return this.themes=[],this.theme=null,n.getItem(r).then(function(e){e||(e=i),t.get(a,{cache:!0}).then(function(t){var n=t.data.themes;s.themes=n,s.theme=n[e],angular.forEach(n,function(e,t){e.key=t}),o.forEach(function(e){e.resolve(s.theme)})})}),this.getCurrentTheme=function(){if(this.theme)return e.when(s.theme);var t=e.defer();return o.push(t),t.promise},this.getThemes=function(){return t.get(a,{cache:!0}).then(function(e){return e.data.themes})},this.setTheme=function(e){this.theme=this.themes[e],n.setItem(r,e)},this}]).filter("altthemesEnabled",function(){return function(e){return e?e.filter(function(e){return!!e.enabled}):e}}).filter("altthemesMatchCurrent",function(){return function(e,t){return e?e.filter(function(e){return!!e.keys.find(function(e){return e===t})}):e}}),angular.module("placenames.navigation",["placenames.altthemes"]).directive("placenamesNavigation",[function(){return{restrict:"AE",template:"<alt-themes current='current'></alt-themes>",scope:{current:"=?"},link:function(e){e.username="Anonymous",e.current||(e.current="none")}}}]).factory("navigationService",[function(){return{}}]),angular.module("placenames.quicksearch",["placenames.pill"]).directive("placenamesQuicksearch",[function(){return{link:function(e){},templateUrl:"quicksearch/quicksearch.html"}}]).directive("placenamesFilteredSummary",["searchService",function(e){return{scope:{state:"="},templateUrl:"quicksearch/filteredsummary.html",link:function(t){t.summary=e.summary}}}]).filter("quicksummary",[function(){return function(e,t){return e.map(function(e){return e[t]+"("+e.count+")"}).join(", ")}}]),angular.module("placenames.proxy",[]).provider("proxy",function(){this.$get=["$http","$q",function(e,t){var n="proxy/";return this.setProxyBase=function(e){n=e},{get:function(e,t){return this._method("get",e,t)},post:function(e,t){return this._method("post",e,t)},put:function(e,t){return this._method("put",e,t)},_method:function(t,r,a){return e[t](n+r,a).then(function(e){return e.data})}}}]}),angular.module("placenames.reset",[]).directive("resetPage",function(e){return{restrict:"AE",scope:{},templateUrl:"reset/reset.html",controller:["$scope",function(t){t.reset=function(){e.location.reload()}}]}}),function(e){e.module("placenames.results.item",[]).directive("placenamesResultsItem",["placenamesItemService","placenamesResultsService","searchService",function(e,t,n){return{templateUrl:"results/item.html",bindToController:{item:"="},controller:function(){console.log("Creating an item scope"),this.showPan=function(e){t.showPan(e)},this.download=function(t){e[t](this)},this.leave=function(){n.hide()},this.enter=function(){n.show(this.item)},this.$destroy=function(){n.hide()}},controllerAs:"vm"}}]).factory("placenamesItemService",["$http","configService",function(e,t){var n={wfs:function(n){t.getConfig("results").then(function(t){var r=t.wfsTemplate;e.get(r.replace("${id}",n.item.recordId)).then(function(e){var t=new Blob([e.data],{type:"application/json;charset=utf-8"});saveAs(t,"gazetteer-wfs-feature-"+n.item.recordId+".xml")})})}};return n}]).filter("itemLongitude",function(){return function(e){return e.split(" ")[0]}}).filter("itemLatitude",function(){return function(e){return e.split(" ")[1]}})}(angular),angular.module("placenames.results",["placenames.results.item","placenames.scroll","placenames.download"]).directive("placenamesZoomToAll",["mapService",function(e){return{template:'<button type="button" class="map-tool-toggle-btn" ng-click="zoomToAll()" title="{{text}}"><span class="hidden-sm">{{text}}</span> <i class="fa fa-lg {{icon}}"></i></button>',scope:{center:"=",zoom:"=",bounds:"=",text:"@",icon:"@"},link:function(t){t.zoomToAll=function(){e.getMap().then(function(e){t.center&&t.zoom?e.setView(t.center,t.zoom):e.fitBounds(t.bounds)})}}}}]).directive("placenamesResultsSummary",[function(){return{templateUrl:"results/summary.html",scope:{state:"="}}}]).directive("placenamesResultsDownload",[function(){return{template:"<placenames-download data='data'></placenames-download>",scope:{data:"="}}}]).directive("placenamesResults",["placenamesResultsService",function(e){return{templateUrl:"results/results.html",restrict:"AE",bindToController:{data:"="},controller:function(){this.clear=function(e){this.data.searched=null},this.more=function(){e.moreDocs(this.data.persist)},this.clear=function(){e.clear(this.data)},this.download=function(){e.download(this.data.persist.data.response.docs.map(function(e){return e.id}))}},controllerAs:"pr",link:function(t){t.$destroy=function(){e.hide()},e.moreDocs(t.pr.data.persist)}}}]).factory("placenamesResultsService",ResultsService).filter("formatDate",function(){return function(e){if(!e)return e;var t=new Date(e);return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}}).filter("resultsHasSomeData",function(){return function(e){return e.some(function(e){return e})}}),ResultsService.$inject=["proxy","$http","$rootScope","$timeout","configService","mapService","searchService"],angular.module("placenames.scroll",[]).directive("commonScroller",["$timeout",function(e){return{scope:{more:"&",buffer:"=?"},link:function(t,n,r){var a=void 0;t.buffer||(t.buffer=100),n.on("scroll",function(n){function r(){t.more&&i.scrollHeight-i.scrollTop<=i.clientHeight+t.buffer&&t.more()}var i=n.currentTarget;e.cancel(a),a=e(r,120)})}}}]),angular.module("placenames.side-panel",[]).factory("panelSideFactory",["$rootScope","$timeout",function(e,t){function n(e,t){var n=e.active;return n===t?(e.active=null,e.width=0):e.active=t,!n}var r={left:{active:null,width:0},right:{active:null,width:0}};return{state:r,setLeft:function(e){var t=n(r.left,e);return t&&(r.left.width=320),t},setRight:function(t){r.right.width=t.width;var a=n(r.right,t.name);return e.$broadcast("side.panel.change",{side:"right",data:r.right,width:t.width}),a}}}]).directive("sidePanelRightOppose",["panelSideFactory",function(e){return{restrict:"E",transclude:!0,template:'<div class="contentContainer" ng-attr-style="right:{{right.width}}"><ng-transclude></ng-transclude></div>',link:function(t){t.right=e.state.right}}}]).directive("sidePanelRight",["panelSideFactory",function(e){return{restrict:"E",transclude:!0,templateUrl:"side-panel/side-panel-right.html",link:function(t){t.right=e.state.right,t.closePanel=function(){e.setRight({name:null,width:0})}}}}]).directive("panelTrigger",["panelSideFactory",function(e){return{restrict:"E",transclude:!0,templateUrl:"side-panel/trigger.html",scope:{"default":"@?",panelWidth:"@",name:"@",iconClass:"@",panelId:"@"},link:function(t){t.toggle=function(){e.setRight({width:t.panelWidth,name:t.panelId})},t["default"]&&e.setRight({width:t.panelWidth,name:t.panelId})}}}]).directive("panelOpenOnEvent",["$rootScope","panelSideFactory",function(e,t){return{restrict:"E",scope:{panelWidth:"@",eventName:"@",panelId:"@",side:"@?"},link:function(n){n.side||(n.side="right"),e.$on(n.eventName,function(e,r){var a=t.state[n.side];if(a&&(!a.active||n.panelId!==a.active)){var i={width:n.panelWidth,name:n.panelId};"right"===n.side?t.setRight(i):t.setLeft(i)}})}}}]).directive("panelCloseOnEvent",["$rootScope","panelSideFactory",function(e,t){return{restrict:"E",scope:{eventName:"@",side:"@?"},link:function(n){n.side||(n.side="right"),e.$on(n.eventName,function(e,r){var a=t.state[n.side];if(a&&a.active){var i={name:null};"right"===n.side?t.setRight(i):t.setLeft(i)}})}}}]).directive("sidePanelLeft",["panelSideFactory",function(e){return{restrict:"E",transclude:!0,templateUrl:"side-panel/side-panel-left.html",link:function(t){t.left=e.state.left,t.closeLeft=function(){e.setLeft(null)}}}}]),angular.module("placenames.search",["placenames.authorities","placenames.groups"]).directive("placenamesClear",["searchService",function(e){return{link:function(t,n){function r(){if(n.is(":focus")){var e=$.Event("keydown");e.which=27,n.trigger(e),n.blur()}}e.onMapUpdate(r)}}}]).directive("placenamesOnEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.placenamesOnEnter)}),t.preventDefault())})}}).directive("placenamesSearchFilters",["groupsService","searchService",function(e,t){return{templateUrl:"search/searchfilters.html",link:function(e){e.summary=t.summary,e.data=t.data}}}]).directive("placenamesOptions",["searchService",function(e){return{link:function(t){t.leave=function(){e.hide()},t.enter=function(){e.show(t.match.model)},t.$destroy=function(){e.hide()}}}}]).directive("placenamesQuickSearch",["$document","$rootScope","$timeout","groupsService","searchService",function(e,t,n,r,a){return{templateUrl:"search/quicksearch.html",restrict:"AE",link:function(r,i){r.state=a.data,e.on("keyup",function(e){27===e.which&&(e.stopPropagation(),e.preventDefault(),r.$apply(function(){r.showFilters=!1}))}),r.loadDocs=function(){return a.filtered().then(function(e){return e.response.docs})},r.clear=function(){r.state.searched=null,n(function(){t.$broadcast("clear.button.fired")},10)},r.search=function(e){r.showFilters=!1,a.search(e),n(function(){t.$broadcast("search.button.fired")},100)}}}}]).directive("placenamesSearch",["$timeout","groupsService","searchService",function(e,t,n){return{templateUrl:"search/search.html",restrict:"AE",link:function(e){e.state=n.data,e.status={},e.$watch("state.searched",function(e,t){!e&&t&&n.filtered()}),n.filtered(),e.update=function(){n.filtered()},e.loadOnEmpty=function(){e.state.filter||n.filtered()},e.select=function(t){e.search(t)},e.deselect=function(e){e.selected=!1,n.filtered()}}}}]).filter("placenamesDocName",[function(){return function(e){return e?e.map(function(e){return e.name+" ("+e.authorityId+")"}):[]}}]).filter("placenamesSomeSelected",[function(){return function(e){return!!e&&Object.keys(e).some(function(t){return e[t].selected})}}]).filter("placenamesUnselectedFacets",[function(){return function(e){return e?e.filter(function(e){return!e.selected}):[]}}]).filter("placenamesSelectedFacets",[function(){return function(e){return e?e.filter(function(e){return e.selected}):[]}}]).filter("placenamesClean",[function(){return function(e){return e.replace(/\s?[, ]\s?/g," ")}}]).filter("placenamesTooltip",[function(){return function(e){var t="<div style='text-align:left'>";if(e.variant){var n=e.variant.split("|");n.forEach(function(e,r){t+=r?"":"Also known as",t+=(r&&r<n.length-1?",":"")+" ",r&&r===n.length-1&&(t+="or "),
t+=e}),t+="<br/>"}return t+="Lat "+e.location.split(" ").reverse().join("&deg; Lng ")+"&deg;<br/>Feature type: "+e.feature+"</div>"}}]),angular.module("placenames.zone",[]).factory("zoneService",["$http","$q","configService",function(e,t,n){return{counts:function(e){var t=this;return n.getConfig("download").then(function(n){var r=n.outCoordSys;return t.intersections(e).then(function(e){var t={};return e.forEach(function(e){t[e.zone.code]=e.intersections.response.numFound}),r.forEach(function(e){e.extent&&(e.intersects=t[e.code]?t[e.code]:0)}),r.filter(function(e){return!e.extent||e.intersects})})})},intersections:function(r){return n.getConfig().then(function(n){var a=n.download.outCoordSys,i=a.filter(function(e){return e.extent}),o=r.bounds,s=r.params.q,c=o.getWest(),l=o.getEast(),u=o.getSouth(),p=o.getNorth(),d=i.filter(function(e){return c<=e.extent.xMax&&l>=e.extent.xMin&&u<=e.extent.yMax&&p>=e.extent.yMin}).map(function(e){return{zone:e,get bounds(){return{xMin:c>e.extent.xMin?c:e.extent.xMin,xMax:l<e.extent.xMax?l:e.extent.xMax,yMin:u>e.extent.yMin?u:e.extent.yMin,yMax:p<e.extent.yMax?p:e.extent.yMax}},get location(){var e=this.bounds;return"location:["+e.yMin+","+e.xMin+" TO "+e.yMax+","+e.xMax+"]"}}}),f=n.zoneQueryTemplate+"&q="+s;return t.all(d.map(function(t){return e.get(f+"&fq="+t.location).then(function(e){var n=e.data;return t.intersections=n,t})}))})}}}]),angular.module("placenames.storage",[]).factory("storageService",["$log","$q",function(e,t){var n="elvis.placenames";return{setGlobalItem:function(e,t){this._setItem("_system",e,t)},setItem:function(e,t){this._setItem(n,e,t)},_setItem:function(t,n,r){e.debug("Fetching state for key locally"+n),localStorage.setItem(t+"."+n,JSON.stringify(r))},getGlobalItem:function(e){return this._getItem("_system",e)},getItem:function(e){var r=t.defer();return this._getItem(n,e).then(function(e){r.resolve(e)}),r.promise},_getItem:function(n,r){e.debug("Fetching state locally for key "+r);var a=localStorage.getItem(n+"."+r);if(a)try{a=JSON.parse(a)}catch(i){}return t.when(a)}}}]),angular.module("placenames.restrict.pan",[]).directive("restrictPan",["mapService",function(e){return{restrict:"AE",scope:{bounds:"="},link:function(t){e.getMap().then(function(e){var n=t.bounds,r=n[0],a=n[1],i=L.latLng(r[0],r[1]),o=L.latLng(a[0],a[1]),s=L.latLngBounds(i,o);e.setMaxBounds(s),e.on("drag",function(){e.panInsideBounds(s,{animate:!1})})})}}}]),angular.module("placenames.utils",[]).filter("placenamesSplitBar",function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="";return e.split("|").forEach(function(e,n,r){t+=(n&&n<r.length-1?",":"")+" ",n&&n===r.length-1&&(t+="or "),t+=e}),t}}).filter("placenamesGoogleLink",["configService",function(e){var t="https://www.google.com/maps/search/?api=1&query=${lat},${lng}";return function(e){if(!e)return"";var n=e.location.split(" ");return t.replace("${lng}",n[0]).replace("${lat}",n[1])}}]).directive("placenamesGoogleAnchor",["configService",function(e){return{scope:{linkTitle:"@",item:"="},template:'<span ng-if="hide">{{item.name}}</span><a ng-if="!hide" ng-href="{{item | placenamesGoogleLink}}" target="_google" title="{{linkTitle}}">{{item.name}}</a>',link:function(t){e.getConfig("hideGoogleLink").then(function(e){t.hide=!!e})}}}]).factory("placenamesUtilsService",["configService",function(e){var t={};return t}]),angular.module("placenames.antarctic",[]).directive("antarcticView",function(){return{restrict:"AE",scope:{},templateUrl:"antarctic/antarctic.html",controller:["$scope",function(e){e.go=function(){window.location="antarctic.html"}}]}}),AboutService.$inject=["configService"],angular.module("placenames.about",[]).directive("placenamesAbout",["$interval","aboutService",function(e,t){return{templateUrl:"about/about.html",scope:{},link:function(n,r){var a=void 0;n.about=t.getState(),n.over=function(){e.cancel(a),n.about.ingroup=!0},n.out=function(){a=e(function(){n.about.ingroup=!1},1e3)},n.unstick=function(){n.about.ingroup=n.about.show=n.about.stick=!1,r.find("a").blur()}}}}]).directive("placenamesAboutLink",["$interval","aboutService",function(e,t){return{restrict:"AE",templateUrl:"about/button.html",scope:{},link:function(n){var r=void 0;n.about=t.getState(),n.over=function(){e.cancel(r),n.about.show=!0},n.toggleStick=function(){n.about.stick=!n.about.stick,n.about.stick||(n.about.show=n.about.ingroup=!1)},n.out=function(){r=e(function(){n.about.show=!1},700)}}}}]).factory("aboutService",AboutService);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),SolrTransformer=function(){function e(t){var n=this;if(_classCallCheck(this,e),t){var r={},a=null;t.forEach(function(e,t){t%2?r[a]=e:a=e}),this.data=r,this.dx=(r.maxX-r.minX)/r.columns,this.dy=(r.maxY-r.minY)/r.rows,this.cells=[],r.counts_ints2D.forEach(function(e,t){e&&e.forEach(function(e,r){if(e){var a={type:"Feature",properties:{count:e},geometry:{type:"Point",coordinates:[]}},i=(a.properties,a.geometry);i.coordinates[0]=n.data.minX+n.dx*(r+.5),i.coordinates[1]=n.data.maxY-n.dy*(t+.5),n.cells.push(a)}})})}}return _createClass(e,[{key:"getGeoJson",value:function(){return{type:"FeatureCollection",features:this.cells}}}]),e}();angular.module("placenames.clusters",[]).directive("placenamesClusters",["placenamesClusterService",function(e){return{link:function(){e.init()}}}]).factory("placenamesClusterService",["$http","$rootScope","configService","flashService","mapService",function(e,t,n,r,a){var i=4e4,o=600,s=50,c={sequence:0,layer:null,timeout:null};return c.init=function(){var e=this;n.getConfig("clusters").then(function(n){a.getMap().then(function(a){function i(){s.layer&&(s.flasher=r.add("Loading features",null,!0),s.map.removeLayer(s.layer),s.layer=null)}function o(e,t){c.timeout&&clearTimeout(c.timeout),c.timeout=setTimeout(function(){s._refreshClusters(t)},10)}e.map=a,e.config=n;var s=e;t.$on("pn.search.complete",o),t.$on("pn.search.start",i)})})},c._refreshClusters=function(t){return t.restrict&&t.response.numFound>o?(clearTimeout(c.debounce),void(c.debounce=setTimeout(function(){var n=Object.assign({},t.responseHeader.params,{rows:o,fq:getBounds(map.getBounds(),t.restrict)});return e({url:"/select?",params:n,method:"get"}).then(function(e){c._refreshClusters2(e.data)})},200))):c._refreshClusters2(t)},c._refreshClusters2=function(t){var n=this,r={showCoverageOnHover:!1,zoomToBoundsOnClick:!0,singleMarkerMode:!0,animate:!1};c.sequence++;var a=c.sequence,l=t.response.numFound;if(this.layer&&this.map.removeLayer(this.layer),l>i){r.iconCreateFunction=function(e){var t=e.getAllChildMarkers().reduce(function(e,t){return e+t.options.count},0),n=" marker-cluster-";return n+=t<1e3?"small":t<5e3?"medium":"large",new L.DivIcon({html:"<div><span>"+Number(t).toLocaleString()+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},this.layer=L.markerClusterGroup(r);var u=t.facet_counts.facet_heatmaps[this.config.countField],p=new SolrTransformer(u),d=p.getGeoJson();Math.max.apply(Math,_toConsumableArray(d.features.map(function(e){return e.properties.count})));p.cells.forEach(function(e){var t=e.properties.count,r=e.geometry.coordinates[1],a=e.geometry.coordinates[0],i=[r,a],o=L.marker(i,{count:t});n.layer.addLayer(o)}),this.flasher&&this.flasher.remove(),this.layer.addTo(this.map)}else if(l>o){r.iconCreateFunction=function(e){var t=e.getChildCount(),n=" marker-cluster-";return n+=t<10?"small":t<100?"medium":"large",new L.DivIcon({html:"<div><span>"+Number(t).toLocaleString()+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},this.layer=L.markerClusterGroup(r);var f=t.facet_counts.facet_heatmaps[this.config.countField],h=new SolrTransformer(f),m=h.getGeoJson();Math.max.apply(Math,_toConsumableArray(m.features.map(function(e){return e.properties.count})));h.cells.forEach(function(e){for(var t=e.properties.count,r=e.geometry.coordinates[1],a=e.geometry.coordinates[0],i=[r,a],o=0;o<t;o++)n.layer.addLayer(L.marker(i))}),this.flasher&&this.flasher.remove(),this.layer.addTo(this.map)}else{var g={q:t.responseHeader.params.q,sort:t.responseHeader.params.sort,rows:l,fq:getBounds(map.getBounds(),t.restrict),wt:"json"};e({url:"/select?",params:g,method:"get"}).then(function(e){if(a!==c.sequence)return void console.log("Bailing out as another post has started since this one started");var t=n.layer=L.layerGroup(),r=e.data.response.docs;r.forEach(function(e){var n=["<table class='cluster-table'>"],a=e.location.split(" "),i=new Date(e.supplyDate),o=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear(),c=!1;n.push("<tr><th>Name </th><td>"+e.name+"</td></tr>"),n.push("<tr><th>Feature type </th><td>"+e.feature+"</td></tr>"),n.push("<tr><th>Category </th><td>"+e.category+"</td></tr>"),n.push("<tr><th>Authority </th><td>"+e.authority+"</td></tr>"),n.push("<tr><th>Supply date</th><td>"+o+"</td></tr>"),n.push("<tr><th>Lat / Lng</th><td>"+a[1]+"° / "+a[0]+"°</td></tr>"),e.icon=declusteredIcon;var l=void 0;r.length>s?l=L.marker([+a[1],+a[0]],e):(e.radius=2,l=L.circleMarker([+a[1],+a[0]],e),t.addLayer(l),l=L.marker([+a[1],+a[0]],{icon:L.divIcon({html:"<div class='cluster-icon'><div class='ellipsis'>"+e.name+"</div></div>"})})),n.push("</table>"),l.bindPopup(n.join("")),l.on("mouseover",function(){this.openPopup()}),l.on("mouseout",function(e){c||this.closePopup()}),l.on("click",function(e){c=!0,this.openPopup()}),l.on("popupclose",function(e){c=!1}),t.addLayer(l)});try{t.addTo(n.map)}catch(i){console.log("What the ")}finally{n.flasher&&n.flasher.remove()}})}},c}]);var RootCtrl=function e(t,n){var r=this;_classCallCheck(this,e),n.getMap().then(function(e){e.fitBounds([[-9.622414142924805,196.61132812500003],[-55.57834467218206,67.06054687500001]]),r.map=e}),t.getConfig().then(function(e){r.data=e})};RootCtrl.$invoke=["configService","mapService"],angular.module("PlacenamesApp",["explorer.config","explorer.confirm","explorer.enter","explorer.flasher","explorer.googleanalytics","explorer.info","explorer.message","explorer.modal","explorer.persist","explorer.version","exp.ui.templates","explorer.map.templates","ui.bootstrap","ngAutocomplete","ngSanitize","page.footer","geo.map","geo.maphelper","placenames.about","placenames.antarctic","placenames.clusters","placenames.contributors","placenames.download","placenames.extent","placenames.header","placenames.help","placenames.lock","placenames.maps","placenames.navigation","placenames.panes","placenames.popover","placenames.proxy","placenames.quicksearch","placenames.reset","placenames.results","placenames.search","placenames.search.service","placenames.side-panel","placenames.splash","placenames.templates","placenames.toolbar","placenames.tree","placenames.utils"]).config(["configServiceProvider","persistServiceProvider","projectsServiceProvider","versionServiceProvider",function(e,t,n,r){e.location("placenames/resources/config/config.json?v=5"),e.dynamicLocation("placenames/resources/config/configclient.json?"),r.url("placenames/assets/package.json"),t.handler("local"),n.setProject("placenames")}]).controller("RootCtrl",RootCtrl).filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=0);var n=["bytes","kB","MB","GB","TB","PB"],r=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(r))).toFixed(t)+" "+n[r]}}).factory("userService",[function(){function e(){return!0}return{login:e,hasAcceptedTerms:e,setAcceptedTerms:e,getUsername:function(){return"anon"}}}]),"every"in Array.prototype||(Array.prototype.every=function(e,t){for(var n=0,r=this.length;n<r;n++)if(n in this&&!e.call(t,this[n],n,this))return!1;return!0}),Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t},r=Math.pow(2,53)-1,a=function(e){var t=n(e);return Math.min(Math.max(t,0),r)};return function(e){var n=this,r=Object(e);if(null===e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i=arguments.length>1?arguments[1]:void 0,o=void 0;if("undefined"!=typeof i){if(!t(i))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(o=arguments[2])}for(var s=a(r.length),c=t(n)?Object(new n(s)):new Array(s),l=0,u=void 0;l<s;)u=r[l],i?c[l]="undefined"==typeof o?i(u,l):i.call(o,u,l):c[l]=u,l+=1;return c.length=s,c}}());var ExtentService=function t(e,n){function r(){e.getMap().then(function(e){e.on("moveend",a),e.on("zoomend",a),a()})}function a(){e.getMap().then(function(e){var t=e.getBounds();i.yMin=t.getSouth(),i.xMin=t.getWest(),i.yMax=t.getNorth(),i.xMax=t.getEast(),n.refresh()})}_classCallCheck(this,t);var i=n.getSearchCriteria().bbox;return i.fromMap&&r(),{getParameters:function(){return i}}};ExtentService.$inject=["mapService","searchService"],angular.module("placenames.extent",["explorer.switch"]).directive("placenamesExtent",["extentService",function(e){return{restrict:"AE",templateUrl:"extent/extent.html",controller:["$scope",function(t){t.parameters=e.getParameters()}],link:function(e,t,n){}}}]).factory("extentService",ExtentService);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),MapsCtrl=function(){function e(t){_classCallCheck(this,e),this.mapService=mapService}return _createClass(e,[{key:"toggleLayer",value:function(e){this.mapsService.toggleShow(e)}}]),e}();MapsCtrl.$inject=["mapsService"];var MapsService=function(){function e(t,n){_classCallCheck(this,e),this.CONFIG_KEY="layersTab",this.configService=t,this.mapService=n,this.configService=t}return _createClass(e,[{key:"getConfig",value:function(){return this.configService.getConfig(this.CONFIG_KEY)}},{key:"toggleShow",value:function(e,t){var n=this;this.configService.getConfig(this.CONFIG_KEY).then(function(t){e.layer?(e.displayed=!1,n.mapService.removeFromGroup(e,t.group)):(n.mapService.addToGroup(e,t.group),e.displayed=!0)})}}]),e}();MapsService.$inject=["configService","mapService"],angular.module("placenames.maps",["explorer.layer.slider"]).directive("placenamesMaps",["mapsService",function(e){return{templateUrl:"maps/maps.html",link:function(t){e.getConfig().then(function(e){t.layersTab=e})}}}]).controller("MapsCtrl",MapsCtrl).service("mapsService",MapsService),angular.module("placenames.popover",[]).directive("placenamesPopover",[function(){return{templateUrl:"popover/popover.html",restrict:"A",transclude:!0,scope:{closeOnEscape:"@",show:"=",containerClass:"=",direction:"@"},link:function(e,t){function n(t){27===t.which&&(t.stopPropagation(),t.preventDefault(),e.$apply(function(){e.show=!1}))}e.direction||(e.direction="bottom"),!e.closeOnEscape||e.closeOnEscape!==!0&&"true"!==e.closeOnEscape||t.on("keyup",n)}}}]),angular.module("placenames.panes",[]).directive("placenamesPanes",["$rootScope","$timeout","mapService",function(e,t,n){return{templateUrl:"panes/panes.html",scope:{defaultItem:"@",data:"="},controller:["$scope",function(r){var a=!1;r.view=r.defaultItem,e.$on("side.panel.change",function(e){function n(){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!0),window.dispatchEvent(e)}n(),t(n,100),t(n,200),t(n,300),t(n,500)}),r.setView=function(t){var i=r.view,o=0;r.view===t?(t&&(a=!0,o=1e3),r.view=""):(t||(a=!0),r.view=t),e.$broadcast("view.changed",r.view,i),a&&n.getMap().then(function(e){e._onResize()})},t(function(){e.$broadcast("view.changed",r.view,null)},50)}]}}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("placenames.search.service",[]).factory("searchService",SearchService),SearchService.$inject=["$http","$rootScope","$timeout","configService","groupsService","mapService"],angular.module("placenames.splash",["ui.bootstrap.modal"]).directive("placenamesSplash",["$rootScope","$uibModal","$log","splashService",function(e,t,n,r){return{controller:["$scope","splashService",function(e,t){e.acceptedTerms=!0,t.getReleaseNotes().then(function(n){e.releaseMessages=n,e.acceptedTerms=t.hasViewedSplash()})}],link:function(a,i){var o=void 0;a.$watch("acceptedTerms",function(e){e===!1&&(o=t.open({templateUrl:"splash/splash.html",size:"lg",backdrop:"static",keyboard:!1,controller:["$scope","acceptedTerms","messages",function(e,t,n){e.acceptedTerms=t,e.messages=n,e.accept=function(){o.close(!0)}}],resolve:{acceptedTerms:function(){return a.acceptedTerms},messages:function(){return a.releaseMessages}}}),o.result.then(function(e){n.info("Accepted terms"),a.acceptedTerms=e,r.setHasViewedSplash(e)},function(){n.info("Modal dismissed at: "+new Date)}))}),e.$on("logoutRequest",function(){userService.setAcceptedTerms(!1)})}}}]).factory("splashService",["$http",function(e){function t(e){e?sessionStorage.setItem(r,!0):sessionStorage.removeItem(r)}function n(){return!!sessionStorage.getItem(r)}var r="placenames.accepted.terms",a="placenames/resources/config/releasenotes.json";return{getReleaseNotes:function(){return e({method:"GET",url:a+"?t="+Date.now()}).then(function(e){return e.data})},hasViewedSplash:n,setHasViewedSplash:t}}]).filter("priorityColor",[function(){var e={IMPORTANT:"red",HIGH:"blue",MEDIUM:"orange",LOW:"gray"};return function(t){return t in e?e[t]:"black"}}]).filter("wordLowerCamel",function(){return function(e){return e.charAt(0)+e.substr(1).toLowerCase()}}).filter("sortNotes",[function(){return function(e){if(e){var t=e.slice(0).sort(function(e,t){return e.priority==t.priority?e.lastUpdate==t.lastUpdate?0:t.lastUpdate-e.lastUpdate:"IMPORTANT"==e.priority?-11:1});return t}}}]),angular.module("placenames.toolbar",[]).directive("placenamesToolbar",[function(){return{templateUrl:"toolbar/toolbar.html",controller:"toolbarLinksCtrl",transclude:!0}}]).controller("toolbarLinksCtrl",["$scope","configService",function(e,t){var n=this;t.getConfig().then(function(e){n.links=e.toolbarLinks}),e.item="",e.toggleItem=function(t){e.item=e.item===t?"":t}}]),angular.module("placenames.templates",[]).run(["$templateCache",function(e){e.put("antarctic/antarctic.html",'<button type="button" class="map-tool-toggle-btn" ng-click="go()" title="Change to Antarctic view">\r\n   <span>Go to Antarctic view</span>\r\n</button>'),e.put("about/about.html",'<span class="about" ng-mouseenter="over()" ng-mouseleave="out()"\r\n      ng-class="(about.show || about.ingroup || about.stick) ? \'transitioned-down\' : \'transitioned-up\'">\r\n   <button class="undecorated about-unstick" ng-click="unstick()" style="float:right">X</button>\r\n   <div class="aboutHeading">About Composite Gazetteer of Australia</div>\r\n   <div ng-repeat="item in about.items">\r\n      <a ng-href="{{item.link}}" name="about{{$index}}" title="{{item.heading}}" target="_blank">\r\n         {{item.heading}}\r\n      </a>\r\n   </div>\r\n</span>'),e.put("about/button.html",'<button ng-mouseenter="over()" ng-mouseleave="out()"\r\n      ng-click="toggleStick()" tooltip-placement="left" uib-tooltip="About Composite Gazetteer of Australia"\r\n      class="btn btn-primary btn-default">About</button>'),e.put("extent/extent.html",'<div class="row" style="border-top: 1px solid gray; padding-top:5px">\r\n\t<div class="col-md-5">\r\n\t\t<div class="form-inline">\r\n\t\t\t<label>\r\n\t\t\t\t<input id="extentEnable" type="checkbox" ng-model="parameters.fromMap" ng-click="change()"></input> \r\n\t\t\t\tRestrict area to map\r\n\t\t\t</label>\r\n\t\t</div>\r\n\t</div>\r\n\t \r\n\t<div class="col-md-7" ng-show="parameters.fromMap">\r\n\t\t<div class="container-fluid">\r\n\t\t\t<div class="row">\r\n\t\t\t\t<div class="col-md-offset-3 col-md-8">\r\n\t\t\t\t\t<strong>Y Max:</strong> \r\n\t\t\t\t\t<span>{{parameters.yMax | number : 4}}</span> \r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<div class="col-md-6">\r\n\t\t\t\t\t<strong>X Min:</strong>\r\n\t\t\t\t\t<span>{{parameters.xMin | number : 4}}</span> \r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="col-md-6">\r\n\t\t\t\t\t<strong>X Max:</strong>\r\n\t\t\t\t\t<span>{{parameters.xMax | number : 4}}</span> \r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<div class="col-md-offset-3 col-md-8">\r\n\t\t\t\t\t<strong>Y Min:</strong>\r\n\t\t\t\t\t<span>{{parameters.yMin | number : 4}}</span> \r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),e.put("maps/maps.html",'<div  ng-controller="MapsCtrl as maps">\r\n\t<div style="position:relative;padding:5px;padding-left:10px;" >\r\n\t\t<div class="panel panel-default" style="padding:5px;" >\r\n\t\t\t<div class="panel-heading">\r\n\t\t\t\t<h3 class="panel-title">Layers</h3>\r\n\t\t\t</div>\r\n\t\t\t<div class="panel-body">\r\n\t\t\t\t<div class="container-fluid">\r\n\t\t\t\t\t<div class="row" ng-repeat="layer in layersTab.layers" \r\n\t\t\t\t\t\t\tstyle="padding:7px;padding-left:10px;position:relative" ng-class-even="\'even\'" ng-class-odd="\'odd\'">\r\n\t\t\t\t\t\t<div style="position:relative;left:6px;">\r\n\t\t\t\t\t\t\t<a href="{{layer.metadata}}" target="_blank" \r\n\t\t\t\t\t\t\t\t\tclass="featureLink" title=\'View metadata related to "{{layer.name}}". (Opens new window.)\'>\r\n\t\t\t\t\t\t\t\t{{layer.name}}\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t<div class="pull-right" style="width:270px;" tooltip="Show on map. {{layer.help}}">\r\n\t\t\t\t\t\t\t\t<span style="padding-left:10px;width:240px;" class="pull-left"><explorer-layer-slider layer="layer.layer"></explorer-layer-slider></span>\r\n\t\t\t\t\t\t\t\t<button style="padding:2px 8px 2px 2px;" type="button" class="undecorated featureLink pull-right" href="javascript:;" \r\n\t\t\t\t\t\t\t\t\t\tng-click="maps.toggleLayer(layer)" >\r\n\t\t\t\t\t\t\t\t\t<i class="fa" ng-class="{\'fa-eye-slash\':(!layer.displayed), \'fa-eye active\':layer.displayed}"></i>\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),e.put("popover/popover.html",'<div class="placenames-popover {{direction}}" ng-class="containerClass" ng-show="show">\r\n  <div class="arrow"></div>\r\n  <div class="placenames-popover-inner" ng-transclude></div>\r\n</div>'),e.put("panes/panes.html",'<div class="mapContainer" class="col-md-12" style="padding-right:0">\r\n   <div class="panesMapContainer" geo-map configuration="data.map"></div>\r\n   <div class="base-layer-controller">\r\n    \t<div geo-draw data="data.map.drawOptions" line-event="elevation.plot.data" rectangle-event="bounds.drawn"></div>\r\n   </div>\r\n   <restrict-pan bounds="data.map.position.bounds"></restrict-pan>\r\n</div>'),e.put("splash/splash.html",'<div class="modal-header">\r\n   <h3 class="modal-title splash">Composite Gazetteer of Australia</h3>\r\n</div>\r\n<div class="modal-body" id="accept" ng-form exp-enter="accept()" placenames-splash-modal style="width: 100%; margin-left: auto; margin-right: auto;">\r\n\t<div style="border-bottom:1px solid gray">\r\n\t\t<p>\r\n\t\t\tUsers can download the Composite Gazetteer of Australia data which is licensed under Creative Commons.\r\n\t\t</p>\r\n\t\t<p>\r\n\t\t\tData can be downloaded from the portal at <strong>no charge</strong> and there is no limit to how many requests you can place (please check the file size before you download your results).\r\n\t\t</p>\r\n\t\t<p>\r\n\t\t\tIf you need datasets in full, please contact <a href="clientservices@ga.gov.au">clientservices@ga.gov.au</a>.\r\n\t\t</p>\r\n\t\t<p>\r\n\t\t\t<a href="http://opentopo.sdsc.edu/gridsphere/gridsphere?cid=contributeframeportlet&gs_action=listTools" target="_blank">Click here for Free GIS Tools.</a>\r\n\t\t</p>\r\n\r\n\t\t<div style="padding:30px; padding-top:0; padding-bottom:40px; width:100%">\r\n\t\t\t<div class="pull-right">\r\n\t\t\t  \t<button type="button" class="btn btn-primary" ng-model="seenSplash" ng-focus ng-click="accept()">Continue</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div ng-show="messages.length > 0" class="container" style="width:100%; max-height:250px; overflow-y:auto">\r\n\t\t<div class="row" ng-class-even="\'grayline\'" style="font-weight:bold">\r\n\t\t\t<div class="col-sm-12" ><h3>News</h3></div>\r\n\t\t</div>\r\n\r\n\t\t<div class="row"ng-class-even="\'grayline\'" style="max-height:400px;overflow:auto" ng-repeat="message in messages | sortNotes">\r\n\t\t\t<div class="col-sm-12">\r\n\t\t\t\t<h4>{{message.title}} <span class="pull-right" style="font-size:70%">Created: {{message.creationDate | date : "dd/MM/yyyy"}}</span></h4>\r\n\t\t\t\t<div ng-bind-html="message.description"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),e.put("toolbar/toolbar.html",'<div class="placenames-toolbar noPrint">\r\n    <div class="toolBarContainer">\r\n        <div>\r\n            <ul class="left-toolbar-items">\r\n               <li>\r\n                  <antarctic-view></antarctic-view>\r\n               </li>\r\n            </ul>\r\n            <ul class="right-toolbar-items">\r\n                <li>\r\n                    <panel-trigger panel-id="search" panel-width="540px" name="Search results" icon-class="fa-list" title="When a search has completed this allows the showing and hiding of the results">\r\n                        <placenames-results-summary state="state"></placenames-results-summary>\r\n                    </panel-trigger>\r\n                </li>\r\n                <li ng-if="state.searched.data.response.numFound">\r\n                   <placenames-zoom-to-all bounds="state.searched.bounds" text="Show searched area" icon="fa-object-group"></placenames-zoom-to-all>\r\n                </li>\r\n                <li reset-page></li>\r\n                <li>\r\n                  <panel-trigger panel-id="help" panel-width="540px" name="Help" icon-class="fa-question-circle-o" title="Show help"></panel-trigger>\r\n               </li>\r\n            </ul>\r\n        </div>\r\n    </div>\r\n</div>'),e.put("side-panel/side-panel-left.html",'<div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" style="width: {{left.width}}px;" ng-class="{\'cbp-spmenu-open\': left.active}">\r\n    <a href="" title="Close panel" ng-click="closeLeft()" style="z-index: 1200">\r\n        <span class="glyphicon glyphicon-chevron-left pull-right"></span>\r\n    </a>\r\n    <div ng-show="left.active === \'legend\'" class="left-side-menu-container">\r\n        <legend url="\'img/AustralianTopogaphyLegend.png\'" title="\'Map Legend\'"></legend>\r\n    </div>\r\n</div>'),e.put("side-panel/side-panel-right.html",'<div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right noPrint" ng-attr-style="width:{{right.width}}" ng-class="{\'cbp-spmenu-open\': right.active}">\r\n    <a href="" title="Close panel" ng-click="closePanel()" style="z-index: 1">\r\n        <span class="glyphicon glyphicon-chevron-right pull-left"></span>\r\n    </a>\r\n    <div ng-show="right.active === \'search\'" class="right-side-menu-container" style="z-index: 2">\r\n        <div class="panesTabContentItem" placenames-search ></div>\r\n    </div>\r\n    <div ng-if="right.active === \'glossary\'" class="right-side-menu-container">\r\n        <div class="panesTabContentItem" placenames-glossary></div>\r\n    </div>\r\n    <div ng-show="right.active === \'help\'" class="right-side-menu-container">\r\n        <div class="panesTabContentItem" placenames-help></div>\r\n    </div>\r\n</div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n'),e.put("authorities/authorities.html",'<div ng-repeat="item in authorities" style="width:49%; display:inline-block">\r\n   <div class="ellipsis" title=\'Jurisdiction: {{item.jurisdiction}}, Authority name: {{item.name}}\'>\r\n      <input type="checkbox" ng-click="update()" ng-model="item.selected" ng-change="change()">\r\n      <span>\r\n         <a target="_blank" href="http://www.google.com/search?q={{item.name}}">{{item.code}}</a>\r\n         ({{(item.allCount | number) + (item.allCount || item.allCount == 0?\' of \':\'\')}}{{item.total | number}})\r\n      </span>\r\n   </div>\r\n</div>'),e.put("categories/categories.html",'<div>\r\n   <div ng-repeat="category in categories | orderBy: \'name\'" ng-attr-title="{{category.definition}}">\r\n      <input type="checkbox" ng-model="category.selected" ng-change="change()">\r\n      <span title="[Group: {{category.parent.name}}], {{category.definition}}">\r\n         {{category.name}}\r\n         ({{(category.allCount | number) + (category.allCount || category.allCount == 0?\' of \':\'\')}}{{category.total}})\r\n      </span>\r\n      <button class="undecorated" ng-click="category.showChildren = !category.showChildren">\r\n         <i class="fa fa-lg" ng-class="{\'fa-question-circle-o\':!category.showChildren, \'fa-minus-square-o\': category.showChildren}"></i>\r\n      </button>\r\n      <div ng-show="category.showChildren" style="padding-left: 8px; border-bottom: solid 1px lightgray">\r\n         <div>[Group: {{category.parent.name}}]\r\n         <div ng-if="category.definition">{{category.definition}}</div>\r\n         It includes the following feature types:\r\n         <placenames-category-children features="category.features"></placenames-category-children>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("categories/features.html",'<div>\n   <div ng-repeat="feature in features" style="padding-left:10px" title="{{feature.definition}}">\n      - {{feature.name}} ({{feature.total}})\n   </div>\n</div>'),e.put("contributors/contributors.html",'<span class="contributors" ng-mouseenter="over()" ng-mouseleave="out()" style="z-index:1500"\r\n      ng-class="(contributors.show || contributors.ingroup || contributors.stick) ? \'transitioned-down\' : \'transitioned-up\'">\r\n   <button class="undecorated contributors-unstick" ng-click="unstick()" style="float:right">X</button>\r\n   <div ng-repeat="contributor in contributors.orgs | activeContributors" style="text-align:cnter">\r\n      <a ng-href="{{contributor.href}}" name="contributors{{$index}}" title="{{contributor.title}}" target="_blank">\r\n         <img ng-src="{{contributor.image}}"  alt="{{contributor.title}}" class="elvis-logo" ng-class="contributor.class"></img>\r\n      </a>\r\n   </div>\r\n</span>'),e.put("contributors/show.html",'<a ng-mouseenter="over()" ng-mouseleave="out()" class="contributors-link" title="Click to lock/unlock contributors list."\r\n      ng-click="toggleStick()" href="#contributors0">Contributors</a>'),e.put("features/features.html",'<div>\r\n      <div ng-repeat="feature in features | orderBy: \'name\'" title="{{feature.definition}}">\r\n         <input type="checkbox" ng-model="feature.selected" ng-change="change()">\r\n         <span title="[Group/category: {{feature.parent.parent.name}}/{{feature.parent.name}}], {{feature.definition}}">\r\n            {{feature.name}} ({{(feature.allCount | number) + (feature.allCount || feature.allCount == 0?\' of \':\'\')}}{{feature.total}})\r\n         </span>\r\n         <button class="undecorated" ng-click="feature.showChildren = !feature.showChildren">\r\n            <i class="fa fa-lg" ng-class="{\'fa-question-circle-o\':!feature.showChildren, \'fa-minus-square-o\': feature.showChildren}"></i>\r\n         </button>\r\n         <div ng-show="feature.showChildren" style="padding-left: 8px; border-bottom: solid 1px lightgray">\r\n            <div ng-if="feature.definition">{{feature.definition}}</div>\r\n            [Group/Category: {{feature.parent.parent.name}}/{{feature.parent.name}}]\r\n         </div>\r\n      </div>\r\n   </div>'),
e.put("download/download.html",'<div class="container-fluid">\r\n   <div class="row">\r\n      <div class="col-md-4">\r\n         <label for="geoprocessOutCoordSys">\r\n            Coordinate System\r\n         </label>\r\n      </div>\r\n      <div class="col-md-8">\r\n         <select style="width:95%" ng-model="processing.outCoordSys" id="geoprocessOutCoordSys"\r\n            ng-options="opt.value for opt in outCoordSys"></select>\r\n      </div>\r\n   </div>\r\n\r\n   <div class="row">\r\n      <div class="col-md-4">\r\n         <label for="geoprocessOutputFormat">\r\n            Output Format\r\n         </label>\r\n      </div>\r\n      <div class="col-md-8">\r\n         <select style="width:95%" ng-model="processing.outFormat" id="geoprocessOutputFormat" ng-options="opt.value for opt in processing.config.outFormat"></select>\r\n      </div>\r\n   </div>\r\n\r\n\r\n   <div class="row" title="You can elect to get common data across the authorities or for each authority receive the authorities data per feature">\r\n      <div class="col-md-4">\r\n         <label for="geoprocessDataFieldsCommon">\r\n            Data fields\r\n         </label>\r\n      </div>\r\n      <div class="col-md-8">\r\n         <label for="geoprocessDataFieldsCommon">Common fields</label>\r\n         <input type="radio" ng-model="processing.dataFields" value="common" id="geoprocessDataFieldsCommon" name="dataFields" checked="checked">\r\n         <label for="geoprocessDataFields">Authorities\' fields</label>\r\n         <input type="radio" ng-model="processing.dataFields" value="authorities" id="geoprocessDataFields" name="dataFields">\r\n      </div>\r\n   </div>\r\n\r\n   <div class="row">\r\n      <div class="col-md-4">\r\n         <label for="geoprocessOutputFormat">\r\n            File name\r\n         </label>\r\n      </div>\r\n      <div class="col-md-8">\r\n         <input type="text" ng-model="processing.filename" class="download-control" placeholder="Optional filename" title="Alphanumeric, hyphen or dash characters, maximium of 16 characters">\r\n      </div>\r\n   </div>\r\n   <div class="row">\r\n      <div class="col-md-4">\r\n         <label for="geoprocessOutputFormat">\r\n            Email\r\n         </label>\r\n      </div>\r\n      <div class="col-md-8">\r\n         <input required="required" type="email" ng-model="processing.email" class="download-control" placeholder="Email address to send download link">\r\n      </div>\r\n   </div>\r\n\r\n   <div class="row">\r\n      <div class="col-md-5" style="padding-top:7px">\r\n         <div class="progress">\r\n            <div class="progress-bar" role="progressbar" aria-valuenow="{{processing.percentComplete}}" aria-valuemin="0" aria-valuemax="100"\r\n               style="width: {{processing.percentComplete}}%;">\r\n               <span class="sr-only"></span>\r\n            </div>\r\n         </div>\r\n      </div>\r\n      <div class="col-md-5" style="padding-top:7px">\r\n         <span style="padding-right:10px" uib-tooltip="Select a valid coordinate system for area." tooltip-placement="bottom">\r\n            <i class="fa fa-file-video-o fa-2x" ng-class="{\'product-valid\': processing.validProjection, \'product-invalid\': !processing.validProjection}"></i>\r\n         </span>\r\n         <span style="padding-right:10px" uib-tooltip="Select a valid download format." tooltip-placement="bottom">\r\n            <i class="fa fa-files-o fa-2x" ng-class="{\'product-valid\': processing.validFormat, \'product-invalid\': !processing.validFormat}"></i>\r\n         </span>\r\n         <span style="padding-right:10px" uib-tooltip="Optional custom filename (alphanumeric, max length 8 characters)" tooltip-placement="bottom">\r\n            <i class="fa fa-save fa-2x" ng-class="{\'product-valid\': processing.validFilename, \'product-invalid\': !processing.validFilename}"></i>\r\n         </span>\r\n         <span style="padding-right:10px" uib-tooltip="Provide an email address." tooltip-placement="bottom">\r\n            <i class="fa fa-envelope fa-2x" ng-class="{\'product-valid\': processing.validEmail, \'product-invalid\': !processing.validEmail}"></i>\r\n         </span>\r\n      </div>\r\n      <div class="col-md-2">\r\n         <button class="btn btn-primary pull-right" ng-disabled="!processing.valid" ng-click="submit()">Submit</button>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("filters/tree.html",'<div style="max-height:300px; overflow-y:auto;padding-left:10px">\r\n   <div ng-repeat="group in groups | withTotals">\r\n      <button class="undecorated" ng-click="group.expanded = !group.expanded" ng-style="{color:group.color}">\r\n         <i class="fa" ng-class="{\'fa-plus\':!group.expanded, \'fa-minus\':group.expanded}"></i>\r\n      </button>\r\n      <input type="checkbox" class="filters-check" ng-model="group.selectExpand" ng-change="change(group)" ng-style="{color:group.color}">\r\n      <span title="{{group.definition}}">\r\n         {{group.name}} ({{(group.allCount | number) + (group.allCount || group.allCount == 0?\' of \':\'\')}}{{group.total | number}})\r\n      </span>\r\n      <div style="padding-left:10px" ng-show="group.expanded">\r\n         <div ng-repeat="category in group.categories | withTotals | orderBy: \'name\'"  ng-attr-title="{{category.definition}}">\r\n            <button class="undecorated" ng-click="category.expanded = !category.expanded" ng-style="{color:category.color}">\r\n               <i class="fa" ng-class="{\'fa-plus\':!category.expanded, \'fa-minus\':category.expanded}"></i>\r\n            </button>\r\n            <input class="filters-check" type="checkbox" ng-model="category.selectExpand" ng-change="change()" ng-style="{color:category.color}">\r\n            <span title="{{category.definition}}">\r\n               {{category.name}}\r\n               ({{(category.allCount | number) + (category.allCount || category.allCount == 0?\' of \':\'\')}}{{category.total}})\r\n            </span>\r\n            <div ng-show="category.expanded" style="padding-left:20px">\r\n               <div ng-repeat="feature in category.features | withTotals | orderBy: \'name\'"  ng-attr-title="{{feature.definition}}">\r\n                  <i class="fa fa-hand-o-right" aria-hidden="true" ng-style="{color:feature.color}"></i>\r\n                  <input class="filters-check" type="checkbox" ng-model="feature.selected" ng-change="change()" ng-style="{color:feature.color}">\r\n                  <span>\r\n                     {{feature.name}}\r\n                     ({{(feature.allCount | number) + (feature.allCount || feature.allCount == 0?\' of \':\'\')}}{{feature.total}})\r\n                  </span>\r\n               </div>\r\n            </div>\r\n         </div>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("groups/category.html",'\r\n<div style="padding-left:10px">\r\n   - <span ng-attr-title="{{category.definition}}">{{category.name}}</span>\r\n   <div ng-repeat="feature in category.features | orderBy:\'name\'" style="padding-left:10px">\r\n      - <span ng-attr-title="{{feature.definition}}">{{feature.name}}</span>\r\n   </div>\r\n</div>\r\n'),e.put("groups/groups.html",'<div>\r\n   <div ng-repeat="group in data.groups">\r\n      <input type="checkbox" ng-model="group.selected" ng-change="change()"><span title="{{group.definition}}">\r\n         {{group.name}} ({{(group.allCount | number) + (group.allCount || group.allCount == 0?\' of \':\'\')}}{{group.total | number}})\r\n      <button class="undecorated" ng-click="group.showChildren = !group.showChildren">\r\n         <i class="fa fa-lg" ng-class="{\'fa-question-circle-o\':!group.showChildren, \'fa-minus-square-o\': group.showChildren}"></i>\r\n      </button>\r\n      <div ng-show="group.showChildren" style="padding-left:8px">\r\n         {{group.definition}}<br/><br/>\r\n         This group is made up of the following categories and feature types:\r\n         <div ng-repeat="category in group.categories" style="padding-left:8px">\r\n            <placenames-group-children category="category"></placenames-group-children>\r\n         </div>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("header/header.html",'<div class="container-full common-header" style="padding-right:10px; padding-left:10px">\r\n   <div class="navbar-header">\r\n\r\n      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".ga-header-collapse">\r\n         <span class="sr-only">Toggle navigation</span>\r\n         <span class="icon-bar"></span>\r\n         <span class="icon-bar"></span>\r\n         <span class="icon-bar"></span>\r\n      </button>\r\n\r\n      <a href="/" class="appTitle visible-xs">\r\n         <h1 style="font-size:120%">{{heading}}</h1>\r\n      </a>\r\n   </div>\r\n   <div class="navbar-collapse collapse ga-header-collapse">\r\n      <ul class="nav navbar-nav">\r\n         <li class="hidden-xs">\r\n            <a href="/" style="margin-top:8px; padding:5px">\r\n               <h1 class="applicationTitle">{{heading}}</h1>\r\n               <h3 ng-if="subheading" class="sub-heading">{{subheading}}</h3>\r\n            </a>\r\n         </li>\r\n      </ul>\r\n      <ul class="nav navbar-nav navbar-right nav-icons">\r\n         <li role="menuitem" style="padding-right:10px;position: relative;top: -3px;">\r\n            <span class="altthemes-container">\r\n               <span>\r\n                  <a title="Location INformation Knowledge platform (LINK)" href="http://fsdf.org.au/" target="_blank">\r\n                     <img alt="FSDF" src="placenames/resources/img/FSDFimagev4.0.png" style="height: 66px">\r\n                  </a>\r\n               </span>\r\n            </span>\r\n         </li>\r\n         <li placenames-navigation role="menuitem" current="current" style="padding-right:10px"></li>\r\n         <li mars-version-display role="menuitem"></li>\r\n         <li style="width:10px"></li>\r\n      </ul>\r\n   </div>\r\n   <!--/.nav-collapse -->\r\n</div>\r\n<div class="contributorsLink" style="position: absolute; right:7px; bottom:25px">\r\n   <placenames-contributors-link></placenames-contributors-link>\r\n</div>\r\n<!-- Strap -->\r\n<div class="row">\r\n   <div class="col-md-12">\r\n      <div class="strap-blue">\r\n      </div>\r\n      <div class="strap-white">\r\n      </div>\r\n      <div class="strap-red">\r\n      </div>\r\n   </div>\r\n</div>'),e.put("help/faqs.html",'<p style="text-align: left; margin: 10px; font-size: 14px;">\r\n   <strong>FAQS</strong>\r\n</p>\r\n\r\n<h5 ng-repeat="faq in faqs"><button type="button" class="undecorated" ng-click="focus(faq.key)">{{faq.question}}</button></h5>\r\n<hr/>\r\n<div class="row" ng-repeat="faq in faqs">\r\n   <div class="col-md-12">\r\n      <h5 tabindex="0" id="faqs_{{faq.key}}">{{faq.question}}</h5>\r\n      <span ng-bind-html="faq.answer"></span>\r\n      <hr/>\r\n   </div>\r\n</div>'),e.put("help/help.html",'<p style="text-align: left; margin: 10px; font-size: 14px;">\r\n\t<strong>Help</strong>\r\n</p>\r\n\r\n<div class="panel-body" ng-controller="HelpCtrl as help">\r\n\tThe steps to get data!\r\n\t<ol>\r\n\t\t<li>Define area of interest</li>\r\n\t\t<li>Select datasets</li>\r\n\t\t<li>Enter email address</li>\r\n\t\t<li>Start extract</li>\r\n\t</ol>\r\n\tAn email will be sent to you on completion of the data extract with a link to your data.\r\n   <hr>\r\n\t<placenames-faqs faqs="help.faqs" ></placenames-faqs>\r\n</div>'),e.put("pill/pill.html",'<span class="btn btn-primary pn-pill" ng-style="item.color?{\'background-color\':item.color, \'padding-top\': \'3px\'}: {\'padding-top\': \'3px\'}">\r\n   <span style="max-width:100px;display:inline-block" title="{{label + item[name]}}" class="ellipsis">{{item[name]}}</span>\r\n   <span class="ellipsis" style="max-width:100px;display:inline-block">\r\n      ({{item.count?item.count:0 | number}})\r\n      <a ng-click="deselect()" href="javascript:void(0)" title="Remove from filters">\r\n         <i class="fa fa-close fa-xs" style="color: white"></i>\r\n      </a>\r\n   </span>\r\n</span>'),e.put("navigation/altthemes.html",'<span class="altthemes-container">\r\n\t<span ng-repeat="item in themes | altthemesMatchCurrent : current">\r\n       <a title="{{item.label}}" ng-href="{{item.url}}" class="altthemesItemCompact" target="_blank">\r\n         <span class="altthemes-icon" ng-class="item.className"></span>\r\n       </a>\r\n    </li>\r\n</span>'),e.put("quicksearch/filteredsummary.html",'<span class="placenames-filtered-summary-child">\r\n   <span style="font-weight:bold; margin:5px;">\r\n      Matched {{state.persist.data.response.numFound | number}}\r\n   </span>\r\n   <span ng-if="summary.authorities.length">\r\n      <span style="font-weight:bold">| For authorities:</span>\r\n      <placenames-pill ng-repeat="item in summary.authorities" name="code" item="item" update="update()"></placenames-pill>\r\n   </span>\r\n   <span ng-if="summary.current.length">\r\n      <span style="font-weight:bold"> | Filtered by {{summary.filterBy}}:</span>\r\n      <placenames-pill ng-repeat="item in summary.current" item="item" update="update()"></placenames-pill>\r\n   </span>\r\n</span>'),e.put("quicksearch/quicksearch.html",'<div class="quickSearch" placenames-quick-search></div>\r\n'),e.put("reset/reset.html",'<button type="button" class="map-tool-toggle-btn" ng-click="reset()" title="Reset page">\r\n   <span class="hidden-sm">Reset</span>\r\n   <i class="fa fa-lg fa-refresh"></i>\r\n</button>'),e.put("results/item.html",'<div ng-mouseenter="vm.enter()" ng-mouseleave="vm.leave()">\r\n<div class="container-fluid">\r\n   <div class="row">\r\n      <div class="col-md-12 pn-header" >\r\n         <button type="button" class="undecorated" ng-click="vm.showPan(vm.item)"\r\n                tooltip-append-to-body="true" title="Zoom to location." tooltip-placement="left" uib-tooltip="Zoom to location">\r\n            <i class="fa fa-lg fa-flag-o"></i>\r\n         </button>\r\n         <span><placenames-google-anchor item="vm.item"\r\n            link-title="View in Google maps. While the location will always be correct, Google will do a best guess at matching the Gazetteer name to its data."></placenames-google-anchor></span>\r\n         <span class="pull-right">Record ID: {{vm.item.authorityId}}</span>\r\n      </div>\r\n   </div>\r\n</div>\r\n<div class="container-fluid">\r\n   <div class="row">\r\n      <div class="col-md-4"  title="An authority can be a state department or other statutory authority">Authority</div>\r\n      <div class="col-md-8">{{vm.item.authority}}</div>\r\n   </div>\r\n   <div class="row">\r\n      <div class="col-md-4" title="Features belong to a category and categories belong to a group">Feature Type</div>\r\n      <div class="col-md-8">{{vm.item.feature}}</div>\r\n   </div>\r\n   <div class="row" title="Features belong to a category and categories belong to a group">\r\n      <div class="col-md-4">Category</div>\r\n      <div class="col-md-8">{{vm.item.category}}</div>\r\n   </div>\r\n   <div class="row" title="Features belong to a category and categories belong to a group">\r\n      <div class="col-md-4">Group</div>\r\n      <div class="col-md-8">{{vm.item.group}}</div>\r\n   </div>\r\n   <div class="row">\r\n      <div class="col-md-4">Supply Date</div>\r\n      <div class="col-md-8" title="Date format is dd/mm/yyyy">{{vm.item.supplyDate | formatDate}}</div>\r\n   </div>\r\n   <div class="row">\r\n      <div class="col-md-4">Lat / Lng</div>\r\n      <div class="col-md-8">\r\n         <span class="pn-numeric">\r\n            {{vm.item.location | itemLatitude}}&deg; / {{vm.item.location | itemLongitude}}&deg;\r\n         </span>\r\n      </div>\r\n   </div>\r\n\r\n</div>'),e.put("results/results.html",'<div class="pn-results-heading" style="min-height:25px" ng-if="pr.data.searched">\r\n   <span ng-if="pr.data.searched.item">\r\n      Showing selected feature\r\n   </span>\r\n   <span ng-if="!pr.data.searched.item">\r\n      Matched {{pr.data.searched.data.response.numFound | number}} features\r\n      <span ng-if="!pr.data.searched.item && pr.data.searched.data.response.numFound > pr.data.searched.data.response.docs.length">, showing {{pr.data.searched.data.response.docs.length | number}}</span>\r\n      <a href "javascript:void()" ng-if="!pr.data.searched.item && pr.data.searched.data.response.numFound > pr.data.searched.data.response.docs.length"\r\n         ng-click="pr.more()" tooltip-placement="bottom" uib-tooltip="Scroll to the bottom of results or click here to load more matching features">\r\n         [Load more]\r\n      </a>\r\n   </span>\r\n   <span class="pull-right">\r\n      <button class="btn btn-primary" style="padding:0 10px" ng-click="pr.showDownload = !pr.showDownload">\r\n         <span ng-if="!pr.showDownload">Download...</span>\r\n         <span ng-if="pr.showDownload">Hide download details</span>\r\n      </button>\r\n      <button class="btn btn-primary" style="padding:0 10px" ng-if="!pr.data.searched.item && !pr.showDownload" ng-click="pr.clear()">\r\n         Clear results\r\n      </button>\r\n   </span>\r\n</div>\r\n<div class="panel panel-default pn-container" ng-if="pr.data.searched" common-scroller buffer="200" more="pr.more()">\r\n   <div class="panel-heading">\r\n      <placenames-search-filters ng-if="pr.data.searched"></placenames-search-filters>\r\n      <placenames-results-item ng-if="pr.data.searched.item" item="pr.data.searched.item"></placenames-results-item>\r\n      <placenames-results-download data="pr.data.searched" ng-if="!pr.data.searched.item && pr.showDownload"></placenames-results-download>\r\n      <div class="pn-results-list" ng-if="!pr.data.searched.item" ng-repeat="doc in pr.data.searched.data.response.docs">\r\n         <placenames-results-item item="doc"></placenames-results-item>\r\n      </div>\r\n   </div>\r\n</div>\r\n<div class="panel panel-default pn-container" ng-if="!pr.data.searched">\r\n   <div class="panel-heading" style="min-height:25px">\r\n      <span style="font-weight:bold">\r\n         Need help on how to search?\r\n      </span>\r\n   </div>\r\n   <div class="panel-body">\r\n      Searching is conducted on the current map view. Pan and zoom the map to your area of interest\r\n      <br/>\r\n      <br/>\r\n      <span class="padding-left:5px">You can apply filters for:</span>\r\n      <div class="well">\r\n         Features matching on partial or like name, groups, categories and features.\r\n         <br/> You can restrict results to only authorities of interest.\r\n         <br/>\r\n         <br/> Once you have zoomed, panned and filtered to your desired results hit the search button to list details with the\r\n         option to download in a variety of projections and formats.\r\n         <br/>\r\n         <br/>\r\n         <b title="nota bene">NB</b> Name searching is done on "fuzzy" searching which means it isn\'t always an exact match but a match something\r\n         like what is typed.\r\n\r\n      </div>\r\n      <div>\r\n         If you are interested in features in the Antarctic consider using the\r\n         <a href="antarctic.html">search specific to the polar view</a>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("results/summary.html",'<span class="placenamesSearchSummary"\r\n      ng-if="state.searched.data.response.numFound">(Found {{state.searched.data.response.numFound | number}} features)</span>'),e.put("side-panel/trigger.html",'<button ng-click="toggle()" type="button" class="map-tool-toggle-btn">\r\n   <span class="hidden-sm">{{name}}</span>\r\n   <ng-transclude></ng-transclude>\r\n   <i class="fa fa-lg" ng-class="iconClass"></i>\r\n</button>'),e.put("search/quicksearch.html",'<div class="search-text">\r\n   <div class="input-group input-group-sm">\r\n      <input type="text" ng-model="state.filter" placeholder="Match by feature name..." placenames-on-enter="search()"\r\n         ng-model-options="{ debounce: 300}" typeahead-on-select="select($item, $model, $label)" typeahead-focus-first="false"\r\n         ng-disabled="state.searched" typeahead-template-url="search/typeahead.html" class="form-control" typeahead-min-length="0"\r\n         uib-typeahead="doc as doc.name for doc in loadDocs(state.filter)" typeahead-loading="loadingLocations" typeahead-no-results="noResults"\r\n         placenames-clear>\r\n\r\n      <span class="input-group-btn">\r\n         <button class="btn btn-primary" type="button" ng-click="search()" title="Search for all features matching your search criteria"\r\n         ng-hide="state.searched" id="placenamesSearchBtn">Search</button>\r\n         <button class="btn btn-primary" type="button" ng-click="showFilters = !showFilters" ng-hide="state.searched" title="SHow/hide filters such as authority, group, category and feature type">Filters...</button>\r\n         <button class="btn btn-primary" title="Clear the current search and enable discovery" type="button" ng-click="clear()" ng-show="state.searched">Clear Search Results</button>\r\n      </span>\r\n   </div>\r\n</div>\r\n<div class="filters" ng-show="showFilters" style="background-color: white">\r\n   <div class="panel panel-default" style="margin-bottom:5px">\r\n      <div class="panel-heading">\r\n         <h4 class="panel-title">\r\n            Filter\r\n            <span ng-if="summary.current.length">ing</span> by groups/categories/features...\r\n         </h4>\r\n      </div>\r\n   </div>\r\n   <placenames-tree></placenames-tree>\r\n   <div class="panel panel-default" style="margin-bottom:5px">\r\n      <div class="panel-heading">\r\n         <h4 class="panel-title">\r\n            Filter\r\n            <span ng-if="summary.authorities.length">ing</span> by authority...\r\n         </h4>\r\n      </div>\r\n      <div style="max-height: 200px; overflow-y: auto; padding:5px">\r\n         <placenames-authorities update="update()"></placenames-authorities>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("search/search.html",'<placenames-results data="state"></placenames-results>\r\n'),e.put("search/searchfilters.html",'<div style="padding-top:5px; padding-bottom:5px">\r\n   <span ng-if="data.filter && !data.filter.location">Matching names like "{{summary.filter}}"</span>\r\n   <span ng-if="summary.current.length">Filtered by: {{summary.current | quicksummary : "name" }}</span>\r\n   <span ng-if="summary.authorities.length">For authorities: {{summary.authorities | quicksummary : "code"}}</span>\r\n</div>'),e.put("search/typeahead.html",'<a placenames-options ng-mouseenter="enter()" ng-mouseleave="leave()"  tooltip-append-to-body="true"\r\n               tooltip-placement="bottom" uib-tooltip-html="match.model | placenamesTooltip">\r\n   <span ng-bind-html="match.model.name | uibTypeaheadHighlight:query"></span>\r\n   (<span ng-bind-html="match.model.authorityId"></span>)\r\n</a>')}]);